// ================= DNS =================
// dns 1.1.1.1 1.0.0.1

// ================= SOCKS PROXIES =================
var MATCH_JO     = "SOCKS 46.185.131.218:20001";   // MATCH (Gameplay) - Jordan-specific, low lag
var LOBBY_PROXY  = "SOCKS 212.35.66.45:8085";     // LOBBY / SOCIAL / CDN - Jordan-specific, low lag
var BLOCK        = "SOCKS 127.0.0.1:9";
var DIRECT       = "DIRECT";

// ================= JORDAN MATCH IPV4 (UPDATED WITH 2026 ALLOCATIONS - ULTRA-TIGHT, NO LEAKS) =================
var JORDAN_MATCH_IPV4 = [
  ["82.212.64.0","255.255.192.0"],    // Orange core
  ["94.249.0.0","255.255.128.0"],     // Orange
  ["176.29.0.0","255.255.0.0"],       // Umniah
  ["46.185.128.0","255.255.128.0"],   // Orange/Umniah
  ["213.6.0.0","255.255.0.0"],        // General Jordan
  ["92.253.0.0","255.255.128.0"],     // Orange new 2026
  ["149.200.128.0","255.255.128.0"],  // Orange new 2026
  ["176.28.128.0","255.255.128.0"],   // Zain core
  ["46.32.96.0","255.255.224.0"],     // Zain
  ["46.248.192.0","255.255.224.0"],   // Umniah
  ["95.172.192.0","255.255.224.0"],   // Umniah
  ["109.107.224.0","255.255.224.0"],  // Umniah
  ["5.45.128.0","255.255.248.0"],     // Umniah
  ["37.123.128.0","255.255.128.0"],   // Zain
  ["87.236.232.0","255.255.248.0"],   // Zain
  ["176.241.0.0","255.255.0.0"],      // Zain
  ["37.18.0.0","255.255.0.0"],        // Umniah
  ["86.108.0.0","255.252.0.0"],       // Orange
  ["90.84.0.0","255.252.0.0"],        // Orange
  ["217.144.0.0","255.255.0.0"],      // Orange
  ["196.201.0.0","255.255.0.0"],      // Orange
  ["62.72.128.0","255.255.128.0"],    // Orange
  ["213.186.32.0","255.255.224.0"],   // Orange
  ["81.21.64.0","255.255.240.0"],     // Orange
  ["37.202.64.0","255.255.192.0"],    // Orange (updated)
  ["80.10.64.0","255.255.240.0"],     // Orange
  ["217.23.32.0","255.255.240.0"],    // Orange
  ["89.28.216.0","255.255.248.0"],    // New 2026
  ["185.33.28.0","255.255.252.0"],    // New 2026
  ["91.212.0.0","255.255.255.0"],     // New 2026
  ["185.68.54.0","255.255.255.0"],    // New 2026
  ["93.191.176.0","255.255.248.0"],   // New 2026
  ["95.141.208.0","255.255.240.0"],   // New 2026
  ["178.77.128.0","255.255.192.0"],   // New 2026
  ["176.57.0.0","255.255.224.0"],     // New 2026
  ["37.17.192.0","255.255.240.0"],    // New 2026
  ["37.123.64.0","255.255.224.0"],    // New 2026
  ["185.160.236.0","255.255.252.0"],  // New 2026
  ["185.40.19.0","255.255.255.0"],    // New 2026
  ["37.75.144.0","255.255.248.0"],    // New 2026
  ["185.173.56.0","255.255.252.0"],   // New 2026
  ["84.252.106.0","255.255.255.0"],   // New 2026
  ["217.29.240.0","255.255.240.0"],   // New 2026
  ["193.203.24.0","255.255.248.0"],   // New 2026
  ["193.203.110.0","255.255.248.0"],  // New 2026
  ["93.95.200.0","255.255.248.0"],    // New 2026
  ["185.176.44.0","255.255.252.0"],   // New 2026
  ["89.20.49.0","255.255.255.0"],     // New 2026
  ["185.43.146.0","255.255.255.0"],   // New 2026
  ["141.98.64.0","255.255.252.0"],    // New 2026
  ["91.132.100.0","255.255.255.0"],   // New 2026
  ["185.241.62.0","255.255.255.0"],   // New 2026
  ["185.135.200.0","255.255.252.0"],  // New 2026
  ["146.19.239.0","255.255.255.0"],   // New 2026
  ["87.238.128.0","255.255.248.0"],   // New 2026
  ["185.159.180.0","255.255.252.0"],  // New 2026
  ["212.35.64.0","255.255.224.0"],    // New 2026
  ["185.80.24.0","255.255.252.0"],    // New 2026
  ["141.0.0.0","255.255.248.0"],      // New 2026
  ["185.182.136.0","255.255.252.0"],  // New 2026
  ["93.115.3.0","255.255.255.0"],     // New 2026
  ["185.180.80.0","255.255.252.0"],   // New 2026
  ["176.118.39.0","255.255.255.0"],   // New 2026
  ["146.19.246.0","255.255.255.0"],   // New 2026
  ["195.20.216.0","255.255.255.0"],   // New 2026
  ["185.234.111.0","255.255.255.0"],  // New 2026
  ["91.223.202.0","255.255.255.0"],   // New 2026
  ["79.134.128.0","255.255.224.0"],   // New 2026
  ["185.139.220.0","255.255.252.0"],  // New 2026
  ["5.199.184.0","255.255.252.0"],    // New 2026
  ["45.142.196.0","255.255.252.0"],   // New 2026
  ["185.24.128.0","255.255.252.0"],   // New 2026
  ["89.38.152.0","255.255.248.0"],    // New 2026
  ["93.115.15.0","255.255.255.0"],    // New 2026
  ["195.18.9.0","255.255.255.0"],     // New 2026
  ["212.34.0.0","255.255.224.0"],     // New 2026
  ["213.139.32.0","255.255.224.0"],   // New 2026
  ["185.98.224.0","255.255.252.0"],   // New 2026
  ["87.236.232.0","255.255.248.0"],   // New 2026
  ["185.200.128.0","255.255.252.0"],  // New 2026
  ["80.90.160.0","255.255.240.0"],    // New 2026
  ["77.245.0.0","255.255.240.0"],     // New 2026
  ["94.142.32.0","255.255.224.0"],    // New 2026
  ["188.247.64.0","255.255.224.0"],   // New 2026
  ["46.32.96.0","255.255.224.0"],     // New 2026
  ["176.28.128.0","255.255.128.0"],   // New 2026
  ["176.29.0.0","255.255.0.0"],       // New 2026
  ["185.109.192.0","255.255.252.0"],  // New 2026
  ["93.115.2.0","255.255.255.0"],     // New 2026
  ["194.104.95.0","255.255.255.0"],   // New 2026
  ["185.57.120.0","255.255.252.0"],   // New 2026
  ["212.118.0.0","255.255.224.0"],    // New 2026
  ["91.186.224.0","255.255.224.0"],   // New 2026
  ["37.220.112.0","255.255.240.0"],   // New 2026
  ["91.106.96.0","255.255.240.0"],    // New 2026
  ["185.12.244.0","255.255.252.0"],   // New 2026
  ["185.253.112.0","255.255.252.0"],  // New 2026
  ["81.28.112.0","255.255.240.0"],    // New 2026
  ["82.212.64.0","255.255.192.0"],    // New 2026
  ["188.123.160.0","255.255.224.0"],  // New 2026
  ["185.175.248.0","255.255.252.0"],  // New 2026
  ["217.144.0.0","255.255.240.0"],    // New 2026
  ["84.18.64.0","255.255.224.0"],     // New 2026
  ["193.188.64.0","255.255.224.0"],   // New 2026
  ["93.93.144.0","255.255.248.0"],    // New 2026
  ["185.109.120.0","255.255.252.0"],  // New 2026
  ["94.127.208.0","255.255.248.0"],   // New 2026
  ["5.198.240.0","255.255.248.0"],    // New 2026
  ["185.14.132.0","255.255.252.0"],   // New 2026
  ["37.252.222.0","255.255.255.0"],   // New 2026
  ["185.10.216.0","255.255.252.0"],   // New 2026
  ["84.18.32.0","255.255.224.0"],     // New 2026
  ["185.163.205.0","255.255.255.0"],  // New 2026
  ["194.165.128.0","255.255.224.0"],  // New 2026
  ["217.23.32.0","255.255.240.0"],    // New 2026
  ["213.186.160.0","255.255.224.0"],  // New 2026
  ["86.108.0.0","255.255.128.0"],     // New 2026
  ["79.173.192.0","255.255.192.0"],   // New 2026
  ["94.249.0.0","255.255.128.0"],     // New 2026
  ["92.253.0.0","255.255.128.0"],     // New 2026
  ["46.185.128.0","255.255.128.0"],   // New 2026
  ["149.200.128.0","255.255.128.0"],  // New 2026
  ["37.202.64.0","255.255.192.0"],    // New 2026
  ["185.98.220.0","255.255.252.0"],   // New 2026
  ["2.59.52.0","255.255.252.0"],      // New 2026
  ["85.159.216.0","255.255.248.0"],   // New 2026
  ["185.80.104.0","255.255.252.0"],   // New 2026
  ["178.238.176.0","255.255.240.0"],  // New 2026
  ["141.105.56.0","255.255.248.0"],   // New 2026
  ["37.44.32.0","255.255.248.0"],     // New 2026
  ["37.152.0.0","255.255.248.0"],     // New 2026
  ["5.45.128.0","255.255.240.0"],     // New 2026
  ["185.19.112.0","255.255.252.0"],   // New 2026
  ["185.197.176.0","255.255.252.0"],  // New 2026
  ["81.21.0.0","255.255.240.0"],      // New 2026
  ["62.72.160.0","255.255.224.0"],    // New 2026
  ["109.237.192.0","255.255.240.0"],  // New 2026
  ["178.20.184.0","255.255.248.0"],   // New 2026
  ["176.57.48.0","255.255.240.0"],    // New 2026
  ["176.241.64.0","255.255.248.0"],   // New 2026
  ["185.51.212.0","255.255.252.0"],   // New 2026
  ["185.193.176.0","255.255.252.0"],  // New 2026
  ["185.30.248.0","255.255.252.0"]    // New 2026
];

// ================= JORDAN WIDE IPV4 (UPDATED WITH 2026 ALLOCATIONS - CORE RANGES ONLY, NO LEAKS) =================
var JORDAN_WIDE_IPV4 = [
  ["82.212.64.0","255.255.192.0"],
  ["94.249.0.0","255.255.128.0"],
  ["176.29.0.0","255.255.0.0"],
  ["176.28.128.0","255.255.128.0"],
  ["46.185.128.0","255.255.128.0"],
  ["213.6.0.0","255.255.0.0"],
  ["212.35.0.0","255.255.0.0"],
  ["86.108.0.0","255.255.128.0"],
  ["92.253.0.0","255.255.128.0"],
  ["149.200.128.0","255.255.128.0"],
  ["79.173.192.0","255.255.192.0"],
  ["46.32.96.0","255.255.224.0"],
  ["46.248.192.0","255.255.224.0"],
  ["95.172.192.0","255.255.224.0"],
  ["109.107.224.0","255.255.224.0"],
  ["37.220.112.0","255.255.240.0"],
  ["46.23.112.0","255.255.240.0"],
  ["5.45.128.0","255.255.248.0"],
  ["37.123.128.0","255.255.128.0"],
  ["87.236.232.0","255.255.248.0"],
  ["176.241.0.0","255.255.0.0"],
  ["37.18.0.0","255.255.0.0"],
  ["85.159.216.0","255.255.248.0"],
  ["178.238.176.0","255.255.240.0"],
  ["141.105.56.0","255.255.248.0"],
  ["37.44.32.0","255.255.248.0"],
  ["37.152.0.0","255.255.248.0"],
  ["185.19.112.0","255.255.248.0"],
  ["185.80.104.0","255.255.248.0"],
  ["92.241.32.0","255.255.224.0"],
  ["196.201.0.0","255.255.0.0"],
  ["62.72.128.0","255.255.128.0"],
  ["213.186.32.0","255.255.224.0"],
  ["81.21.64.0","255.255.240.0"],
  ["86.108.0.0","255.252.0.0"],
  ["90.84.0.0","255.252.0.0"],
  ["217.144.0.0","255.255.0.0"],
  ["37.202.64.0","255.255.192.0"],
  ["80.10.64.0","255.255.240.0"],
  ["217.23.32.0","255.255.240.0"],
  ["89.28.216.0","255.255.248.0"],    // New 2026
  ["185.33.28.0","255.255.252.0"],    // New 2026
  ["91.212.0.0","255.255.255.0"],     // New 2026
  ["185.68.54.0","255.255.255.0"],    // New 2026
  ["93.191.176.0","255.255.248.0"],   // New 2026
  ["95.141.208.0","255.255.240.0"],   // New 2026
  ["178.77.128.0","255.255.192.0"],   // New 2026
  ["176.57.0.0","255.255.224.0"],     // New 2026
  ["37.17.192.0","255.255.240.0"],    // New 2026
  ["37.123.64.0","255.255.224.0"],    // New 2026
  ["185.160.236.0","255.255.252.0"],  // New 2026
  ["185.40.19.0","255.255.255.0"],    // New 2026
  ["37.75.144.0","255.255.248.0"],    // New 2026
  ["185.173.56.0","255.255.252.0"],   // New 2026
  ["84.252.106.0","255.255.255.0"],   // New 2026
  ["217.29.240.0","255.255.240.0"],   // New 2026
  ["193.203.24.0","255.255.248.0"],   // New 2026
  ["193.203.110.0","255.255.248.0"],  // New 2026
  ["93.95.200.0","255.255.248.0"],    // New 2026
  ["185.176.44.0","255.255.252.0"],   // New 2026
  ["89.20.49.0","255.255.255.0"],     // New 2026
  ["185.43.146.0","255.255.255.0"],   // New 2026
  ["141.98.64.0","255.255.252.0"],    // New 2026
  ["91.132.100.0","255.255.255.0"],   // New 2026
  ["185.241.62.0","255.255.255.0"],   // New 2026
  ["185.135.200.0","255.255.252.0"],  // New 2026
  ["146.19.239.0","255.255.255.0"],   // New 2026
  ["87.238.128.0","255.255.248.0"],   // New 2026
  ["185.159.180.0","255.255.252.0"],  // New 2026
  ["212.35.64.0","255.255.224.0"],    // New 2026
  ["185.80.24.0","255.255.252.0"],    // New 2026
  ["141.0.0.0","255.255.248.0"],      // New 2026
  ["185.182.136.0","255.255.252.0"],  // New 2026
  ["93.115.3.0","255.255.255.0"],     // New 2026
  ["185.180.80.0","255.255.252.0"],   // New 2026
  ["176.118.39.0","255.255.255.0"],   // New 2026
  ["146.19.246.0","255.255.255.0"],   // New 2026
  ["195.20.216.0","255.255.255.0"],   // New 2026
  ["185.234.111.0","255.255.255.0"],  // New 2026
  ["91.223.202.0","255.255.255.0"],   // New 2026
  ["79.134.128.0","255.255.224.0"],   // New 2026
  ["185.139.220.0","255.255.252.0"],  // New 2026
  ["5.199.184.0","255.255.252.0"],    // New 2026
  ["45.142.196.0","255.255.252.0"],   // New 2026
  ["185.24.128.0","255.255.252.0"],   // New 2026
  ["89.38.152.0","255.255.248.0"],    // New 2026
  ["93.115.15.0","255.255.255.0"],    // New 2026
  ["195.18.9.0","255.255.255.0"],     // New 2026
  ["212.34.0.0","255.255.224.0"],     // New 2026
  ["213.139.32.0","255.255.224.0"],   // New 2026
  ["185.98.224.0","255.255.252.0"],   // New 2026
  ["87.236.232.0","255.255.248.0"],   // New 2026
  ["185.200.128.0","255.255.252.0"],  // New 2026
  ["80.90.160.0","255.255.240.0"],    // New 2026
  ["77.245.0.0","255.255.240.0"],     // New 2026
  ["94.142.32.0","255.255.224.0"],    // New 2026
  ["188.247.64.0","255.255.224.0"],   // New 2026
  ["46.32.96.0","255.255.224.0"],     // New 2026
  ["176.28.128.0","255.255.128.0"],   // New 2026
  ["176.29.0.0","255.255.0.0"],       // New 2026
  ["185.109.192.0","255.255.252.0"],  // New 2026
  ["93.115.2.0","255.255.255.0"],     // New 2026
  ["194.104.95.0","255.255.255.0"],   // New 2026
  ["185.57.120.0","255.255.252.0"],   // New 2026
  ["212.118.0.0","255.255.224.0"],    // New 2026
  ["91.186.224.0","255.255.224.0"],   // New 2026
  ["37.220.112.0","255.255.240.0"],   // New 2026
  ["91.106.96.0","255.255.240.0"],    // New 2026
  ["185.12.244.0","255.255.252.0"],   // New 2026
  ["185.253.112.0","255.255.252.0"],  // New 2026
  ["81.28.112.0","255.255.240.0"],    // New 2026
  ["82.212.64.0","255.255.192.0"],    // New 2026
  ["188.123.160.0","255.255.224.0"],  // New 2026
  ["185.175.248.0","255.255.252.0"],  // New 2026
  ["217.144.0.0","255.255.240.0"],    // New 2026
  ["84.18.64.0","255.255.224.0"],     // New 2026
  ["193.188.64.0","255.255.224.0"],   // New 2026
  ["93.93.144.0","255.255.248.0"],    // New 2026
  ["185.109.120.0","255.255.252.0"],  // New 2026
  ["94.127.208.0","255.255.248.0"],   // New 2026
  ["5.198.240.0","255.255.248.0"],    // New 2026
  ["185.14.132.0","255.255.252.0"],   // New 2026
  ["37.252.222.0","255.255.255.0"],   // New 2026
  ["185.10.216.0","255.255.252.0"],   // New 2026
  ["84.18.32.0","255.255.224.0"],     // New 2026
  ["185.163.205.0","255.255.255.0"],  // New 2026
  ["194.165.128.0","255.255.224.0"],  // New 2026
  ["217.23.32.0","255.255.240.0"],    // New 2026
  ["213.186.160.0","255.255.224.0"],  // New 2026
  ["86.108.0.0","255.255.128.0"],     // New 2026
  ["79.173.192.0","255.255.192.0"],   // New 2026
  ["94.249.0.0","255.255.128.0"],     // New 2026
  ["92.253.0.0","255.255.128.0"],     // New 2026
  ["46.185.128.0","255.255.128.0"],   // New 2026
  ["149.200.128.0","255.255.128.0"],  // New 2026
  ["37.202.64.0","255.255.192.0"],    // New 2026
  ["185.98.220.0","255.255.252.0"],   // New 2026
  ["2.59.52.0","255.255.252.0"],      // New 2026
  ["85.159.216.0","255.255.248.0"],   // New 2026
  ["185.80.104.0","255.255.252.0"],   // New 2026
  ["178.238.176.0","255.255.240.0"],  // New 2026
  ["141.105.56.0","255.255.248.0"],   // New 2026
  ["37.44.32.0","255.255.248.0"],     // New 2026
  ["37.152.0.0","255.255.248.0"],     // New 2026
  ["5.45.128.0","255.255.240.0"],     // New 2026
  ["185.19.112.0","255.255.252.0"],   // New 2026
  ["185.197.176.0","255.255.252.0"],  // New 2026
  ["81.21.0.0","255.255.240.0"],      // New 2026
  ["62.72.160.0","255.255.224.0"],    // New 2026
  ["109.237.192.0","255.255.240.0"],  // New 2026
  ["178.20.184.0","255.255.248.0"],   // New 2026
  ["176.57.48.0","255.255.240.0"],    // New 2026
  ["176.241.64.0","255.255.248.0"],   // New 2026
  ["185.51.212.0","255.255.252.0"],   // New 2026
  ["185.193.176.0","255.255.252.0"],  // New 2026
  ["185.30.248.0","255.255.252.0"]    // New 2026
];

// ================= JORDAN MATCH IPV6 (UPDATED WITH 2026 ALLOCATIONS - NO LEAKS) =================
var JORDAN_MATCH_IPV6 = [
  ["2001:32c0::", "29"],
  ["2a00:18d0::", "32"],
  ["2a00:18d8::", "29"],
  ["2a03:6d00::", "32"],  // Umniah
  ["2a05:7500::", "29"],  // Umniah
  ["2a13:8d40::", "29"],  // Zain Jordan
  ["2a02:248::", "29"],   // Orange Jordan
  ["2a00:1a30::", "32"],
  ["2a00:1a38::", "29"],
  ["2a10:9740::", "29"],
  ["2a10:d800::", "29"],
  ["2a00:1a60::", "29"],
  ["2a00:1a68::", "29"],
  ["2a00:1a70::", "32"],
  ["2a00:1a78::", "29"],
  ["2a00:1a80::", "29"],
  ["2a00:1a88::", "29"],
  ["2a00:1a90::", "32"],
  ["2a00:1a98::", "29"],
  ["2a00:1aa0::", "29"],
  ["2a02:c040::", "29"],             // New 2026
  ["2a00:caa0::", "32"],             // New 2026
  ["2001:32c0::", "29"],             // New 2026
  ["2a02:2558::", "29"],             // New 2026
  ["2a0d:cf40::", "29"],             // New 2026
  ["2a10:1100::", "29"],             // New 2026
  ["2a13:5c00::", "29"],             // New 2026
  ["2a13:1f00::", "29"],             // New 2026
  ["2a00:76e0::", "32"],             // New 2026
  ["2a06:bd80::", "29"],             // New 2026
  ["2a14:1a40::", "29"],             // New 2026
  ["2a04:6200::", "29"],             // New 2026
  ["2a03:6b00::", "29"],             // New 2026
  ["2a05:74c0::", "29"],             // New 2026
  ["2a11:d180::", "29"],             // New 2026
  ["2a01:e240::", "29"],             // New 2026
  ["2a02:f0c0::", "29"],             // New 2026
  ["2a0c:39c0::", "29"],             // New 2026
  ["2a02:9c0::", "29"]               // New 2026
];

// ================= JORDAN WIDE IPV6 (UPDATED WITH 2026 ALLOCATIONS - NO LEAKS) =================
var JORDAN_WIDE_IPV6 = JORDAN_MATCH_IPV6;

// ================= JORDAN ISP ALLOWLIST (UPDATED FOR 2026 - NO CHANGE) =================
function isJordanISP(ip){
  return (
    /* ZAIN */
    isInNet(ip, "37.123.128.0", "255.255.128.0") ||
    isInNet(ip, "87.236.232.0", "255.255.248.0") ||
    isInNet(ip, "94.249.0.0", "255.255.128.0") ||
    isInNet(ip, "176.241.0.0", "255.255.0.0") ||

    /* UMNIAH */
    isInNet(ip, "176.29.0.0", "255.255.0.0") ||
    isInNet(ip, "46.185.128.0", "255.255.128.0") ||
    isInNet(ip, "37.18.0.0", "255.255.0.0") ||

    /* ORANGE */
    isInNet(ip, "196.201.0.0", "255.255.0.0") ||
    isInNet(ip, "62.72.128.0", "255.255.128.0") ||
    isInNet(ip, "213.186.32.0", "255.255.224.0") ||
    isInNet(ip, "81.21.64.0", "255.255.240.0") ||

    /* ORANGE CORE / FTTH */
    isInNet(ip, "86.108.0.0", "255.252.0.0") ||
    isInNet(ip, "90.84.0.0", "255.252.0.0") ||
    isInNet(ip, "217.144.0.0", "255.255.0.0")
  );
}

// ================= SESSION =================
var SESSION = {
  matchNet: null,
  matchHost: null,
  dnsCache: {}
};

// ================= HELPERS =================
function norm(h){
  var i=h.indexOf(":");
  return i>-1?h.substring(0,i):h;
}

function isInList(ip, list){
  for (var i=0;i<list.length;i++)
    if (isInNet(ip, list[i][0], list[i][1])) return true;
  return false;
}

function resolvePinned(host){
  if (SESSION.dnsCache[host]) return SESSION.dnsCache[host];
  var ip = dnsResolve(host);
  if (ip) SESSION.dnsCache[host] = ip;
  return ip;
}

function resetSession(){
  SESSION.matchNet  = null;
  SESSION.matchHost = null;
}

// ================= PORT / UDP INFERENCE =================
function getPort(url){
  var m = url.match(/:(\d+)/);
  return m ? parseInt(m[1],10) : 0;
}

function isMatchPort(url){
  var p = getPort(url);
  return (p >= 7000 && p <= 9000);
}

function isUDPFirst(u,h){
  return isMatchPort(u) || /udp|realtime|tick|sync|frame|state/i.test(u+h);
}

// ================= PUBG DOMAIN ALLOWLIST =================
function isPUBG(host){
  return (
    shExpMatch(host, "*.pubgmobile.com") ||
    shExpMatch(host, "*.pubgmobile.net") ||
    shExpMatch(host, "*.igamecj.com") ||
    shExpMatch(host, "*.tencent.com") ||
    shExpMatch(host, "*.gcloudcs.com") ||
    shExpMatch(host, "*.qcloud.com") ||
    shExpMatch(host, "*.levelinfinite.com") ||
    shExpMatch(host, "*.krafton.com") ||
    shExpMatch(host, "*.amazonaws.com") ||
    shExpMatch(host, "*.cloudfront.net") ||
    shExpMatch(host, "*.akamaized.net") ||
    shExpMatch(host, "*.akamai.net")
  );
}

// ================= DETECTION =================
function isMatch(u,h){
  return (
    isMatchPort(u) ||
    isUDPFirst(u,h) ||
    /match|battle|game|combat|room|server|logic/i.test(u+h) ||
    /classic|ranked|arena|tdm|payload|metro|zombie|wow|training|custom|event/i.test(u+h)
  );
}

function isLobby(u,h){
  return /lobby|matchmaking|queue|dispatch|gateway|region|prepare|entry/i.test(u+h);
}

function isSocial(u,h){
  return /friend|invite|squad|team|party|clan|presence|chat|voice/i.test(u+h);
}

function isCDN(u,h){
  return /cdn|asset|resource|patch|update|download|media|pak|obb/i.test(u+h);
}

// ================= MAIN =================
function FindProxyForURL(url, host) {

  host = norm(host.toLowerCase());
  if (!isPUBG(host)) return BLOCK;

  var ip = resolvePinned(host);
  if (!ip || ip.indexOf(":")>-1) return BLOCK;

  // ===== JORDAN ISP ONLY =====
  if (!isJordanISP(ip)) return BLOCK;

  // ===== MATCH (PINNED / PORT / UDP-FIRST) =====
  if (isMatch(url, host)) {

    if (!isInList(ip, JORDAN_MATCH_IPV4)) return BLOCK;

    var net24 = ip.split('.').slice(0,3).join('.');
    
    if (!SESSION.matchNet) {
      SESSION.matchNet  = net24;
      SESSION.matchHost = host;
      return MATCH_JO;
    }

    if (host !== SESSION.matchHost) return BLOCK;
    if (net24 !== SESSION.matchNet) return BLOCK;

    return MATCH_JO;
  }

  // ===== LOBBY (AUTO RESET) =====
  if (isLobby(url, host)) {
    resetSession();
    if (!isInList(ip, JORDAN_WIDE_IPV4)) return BLOCK;
    return LOBBY_PROXY;
  }

  // ===== SOCIAL / CDN =====
  if (isSocial(url, host) || isCDN(url, host)) {
    if (!isInList(ip, JORDAN_WIDE_IPV4)) return BLOCK;
    return LOBBY_PROXY;
  }

  return LOBBY_PROXY;
}

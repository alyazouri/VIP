/*********************************************************************
 * PUBG-JO-ULTRA-HARD-LOCK-SMART.pac
 * Ultra Hard Region Lock + Smart Routing
 * جاهز للاستخدام
 *********************************************************************/

const JO_PROXY = "PROXY 37.44.38.20:443";
const BLOCK    = "PROXY 0.0.0.0:0";
const DIRECT   = "DIRECT";

/* ==============================
   نطاقات الأردن (أولوية قصوى)
============================== */
const JO_CIDR = [
  ["176.29.0.0","255.255.0.0"],
  ["178.20.224.0","255.255.224.0"],
  ["46.32.96.0","255.255.240.0"],
  ["82.212.64.0","255.255.192.0"],
  ["213.6.0.0","255.255.0.0"]
];

/* ==============================
   نطاق ~1500km حول الأردن
   (قريب فقط)
============================== */
const REGION_CIDR = [

  // فلسطين / إسرائيل
  ["31.168.0.0","255.255.0.0"],
  ["80.179.0.0","255.255.0.0"],

  // لبنان
  ["178.135.0.0","255.255.0.0"],

  // شمال السعودية
  ["5.32.0.0","255.224.0.0"],

  // غرب العراق
  ["37.236.0.0","255.255.0.0"],

  // شمال مصر
  ["41.32.0.0","255.224.0.0"]
];

/* ==============================
   نطاقات Cloud / VPN / Anycast
============================== */
const VPN_CIDR = [
  ["104.16.0.0","255.240.0.0"],   // Cloudflare
  ["172.64.0.0","255.192.0.0"],
  ["34.0.0.0","255.0.0.0"],       // Google Cloud
  ["35.0.0.0","255.0.0.0"],
  ["52.0.0.0","255.0.0.0"],       // AWS
  ["54.0.0.0","255.0.0.0"],
  ["20.0.0.0","255.0.0.0"],       // Azure
  ["45.0.0.0","255.0.0.0"],
  ["23.0.0.0","255.0.0.0"],
  ["8.8.8.0","255.255.255.0"]     // Public DNS tricks
];

/* ==============================
   أدوات
============================== */

function norm(h){
  let i = h.indexOf(":");
  return i > -1 ? h.substring(0,i) : h;
}

function isPUBG(h){
  return /pubg|pubgm|tencent|krafton|lightspeed|levelinfinite/i.test(h);
}

function inList(ip, list){
  for(let i=0;i<list.length;i++){
    if(isInNet(ip, list[i][0], list[i][1])) return true;
  }
  return false;
}

/* ==============================
   الدالة الرئيسية
============================== */

function FindProxyForURL(url, host){

  host = norm(host.toLowerCase());

  // أي شيء ليس PUBG → اتصال طبيعي
  if(!isPUBG(host)){
    return DIRECT;
  }

  var ip = dnsResolve(host);

  // منع IPv6 أو DNS فشل
  if(!ip || ip.indexOf(":")>-1){
    return BLOCK;
  }

  // منع VPN / Cloud
  if(inList(ip, VPN_CIDR)){
    return BLOCK;
  }

  // أولوية الأردن (أقل بنق)
  if(inList(ip, JO_CIDR)){
    return JO_PROXY;
  }

  // السماح فقط بنطاق قريب جداً
  if(inList(ip, REGION_CIDR)){
    return JO_PROXY;
  }

  // أي شيء خارج المنطقة → حجب كامل
  return BLOCK;
}
